# 逆算の思考（ゴールからの設計）

## 概要

逆算の思考とは、最終的に得たい結果（ゴール）を最初に明確化し、そこから必要な要素を逆順で設計する方法です。いきなり実装に着手するのではなく、まず「出口」を定めることで実装のぶれを防ぎ、最短経路で目的を達成する設計を導き出せます。

## 基本手順（3ステップ）

1. ゴール（出力）を定義する
   - 得たい結果を具体的に記述します。フォーマット、型、例を含めるとよいです。
2. 必要なデータ（入力）を特定する
   - ゴールを生成するために最低限必要な情報を列挙します。欠損時の挙動も定義します。
3. 最短経路（処理フロー）を設計する
   - 入力から出力までをつなぐ最小限の処理を逆算して決めます。余分な処理を排し、境界条件を明確にします。

## 教え方のポイント

- 結論から逆算する習慣をつけます。数学の証明のように、まず結論を掲げ、そこから必要な前提や補題（中間処理）を逆に導く練習を行います。
- ゴールはできるだけ具体化します（例："CSVで日付・ID・値の3列を持つファイル"）。抽象的なゴールは逆算を困難にします。
- 出力例（期待される出力のサンプル）を先に用意し、テストとして利用します。テストファーストの簡易版と考えてください。

## 実践例（C#風の疑似コード）

課題：ユーザーの氏名と生年月日から年齢を計算し、成人かどうかを判定して表示するCSVを作成します。

1. ゴール（出力）：
   - CSVファイル（ヘッダ: Name, BirthDate, Age, IsAdult）
   - 各行の`IsAdult`は Age >= 18 のとき `true` になります
2. 入力：
   - ユーザーリスト（Name:string, BirthDate:DateTime）
3. 最短経路：
   - 各ユーザーについて年齢を計算する関数を用意します
   - 判定ロジックを適用して`IsAdult`を付与します
   - CSVを書き出します

疑似コード:

```csharp
int CalculateAge(DateTime birthDate) { /* 今日の日付から年を計算 */ }

var users = LoadUsers();
var rows = users.Select(u => new {
    u.Name,
    BirthDate = u.BirthDate.ToString("yyyy-MM-dd"),
    Age = CalculateAge(u.BirthDate),
    IsAdult = CalculateAge(u.BirthDate) >= 18
});
WriteCsv("output.csv", rows);
```

## よくある迷いと対処

- 入力が未定義だが進めたい場合：まずは仮の最小入力仕様（スキーマ）を定め、後で拡張します。
- 途中の中間データが複雑な場合：中間成果物を小さな検証可能な単位に分け、順に検証します。
- 複数のゴールがある場合：各ゴールについて個別に逆算を行い、共通処理を抽出します。

## 学習用課題

### 課題1：逆算での設計練習（短）

問題：整数のリストを受け取り、奇数のみを抽出してその合計を返す関数を作成します。

- ゴールを具体化します（戻り値の型や例を示す）
- 必要な入力を列挙します
- 入力から出力への最短処理手順を3行程度で記述します

### 課題2：逆算での設計練習（実践）

問題：Webフォームからの注文データを受け取り、注文完了メールの本文（プレーンテキスト）を生成する機能を設計します。

- 期待する出力の例を1つ示します（メール本文のサンプル）
- その出力を生成するために必要な入力項目を列挙します
- 入力から出力までの最短処理フローをステップ化します

### 課題3：設計レビュー

以下の設計メモを逆算の観点でレビューし、改善点を述べます。

- ゴール: ユーザーの購入履歴から月別売上合計を算出するレポート（PDF）
- 現状のメモ: "DBから購入履歴を取得して、月ごとに合計を算出し、PDFにする"

ヒント: 出力フォーマット、必要なデータ整形、集計の粒度、エラー時の振る舞いを明確にします。

---

## 参考：模範解答（課題1）

- ゴール: 整数リストから奇数のみ抽出し、合計（int）を返します。例: [1,2,3,4] -> 1+3 = 4
- 入力: int[] numbers（NULLや空配列の扱いを定義します）
- 最短経路:
  1. NULLチェック／空配列は0を返します
  2. 奇数だけをフィルタします
  3. フィルタ結果を合計して返します

```csharp
int SumOdd(int[] numbers) {
    if (numbers == null || numbers.Length == 0) return 0;
    return numbers.Where(n => n % 2 != 0).Sum();
}
```
